<!-- 
<h1>Pages#welcome</h1>
<p>Find me in app/views/pages/welcome.html.erb</p>
 -->

<script type="text/javascript" src="http://code.jquery.com/jquery.min.js"></script>

<div id="full-width-background">
  <div class="row">
    <div class="small-1 med-1 large-1 columns">&nbsp;</div>
    <div id="card-container" class="small-10 med-8 large-8 columns">
    <div class="small-1 med-1 large-1 columns">&nbsp;</div>
  </div>
</div>



<script type="text/javascript">
 
var attemptArray = [];
var sampleFacts = <%=raw @sample_facts %>;
var card_counter = 0;
var mcTemplate = '<h2 id="card-header">&nbsp</h2><div id="answer-canvas"></div><div id="answer-basket"></div>'


var freeTemplate = '<h2 id="card-header">&nbsp</h2><div id="answer-canvas"></div><div id="answer-basket"></div>'

var puzzleTemplate = '<h2 id="card-header">&nbsp</h2><div id="answer-canvas"></div><div id="answer-basket"></div>'

// These click handlers are for the puzzle format
$("#card-container").on('click', "#answer-canvas .answer-object",
  function(){
    var $this = $(this);
    $("#answer-basket").append(this);
    var delete_index = attemptArray.indexOf($this.text());
    attemptArray.splice(delete_index, 1);
  }
)


$("#card-container").on('click', "#answer-basket .answer-object",
  function(){
    var $this = $(this);
    $("#answer-canvas").append(this);
    attemptArray.push($this.text());
    console.log(check_answer(attemptArray));
    // var answer_correct = check_answer(attemptArray);
    if(check_answer(attemptArray) && card_counter < sampleFacts.length) {
      $("#answer-canvas > div").css({"border": "1px solid #669900", "background-color": "#89c43e", "color" : "white"});
      $.ajax({
        type: "POST",
        data: "",
        url: "",
        success: setTimeout(function(){
          clearOldCard();
          showRandomCard();
          
          }, 2000)
      }); 
    }
  }
)
// Setup functions for handing each card type

var puzzle = function(){
  clearOldCard();
  $("#card-container").append(puzzleTemplate);
  alert("Puzzle Card!");
  aCardDefinition = shuffle(sampleFacts[card_counter].definition.slice(0));
  
  for(i = 0; i < aCardDefinition.length; i++){

    var $div = $('<div class="answer-object answer">'+aCardDefinition[i]+'</div>')
    var header = sampleFacts[card_counter].term;
    $("#answer-basket").append($div);
    $("#card-header").text(header);
  };
  card_counter = card_counter+ 1;

};

var free = function(){
  showRandomCard();

};

var mc = function(){
  showRandomCard();
};

// --------------------


var clearOldCard = function() {
  $("#card-container").empty();
  attemptArray = [];

};

var getPuzzleCard = function() {
}


var check_answer = function(attemptArray) {
  var joined_array = attemptArray.join("");
  var answer = (sampleFacts[card_counter-1].definition);
  console.log("joined_array: "+joined_array);
  console.log("answer: "+answer.join(""));
  return joined_array == answer.join("");
 
}

function shuffle(array) {
    for (var i = array.length - 1; i > 0; i--) {
        var j = Math.floor(Math.random() * (i + 1));
        var temp = array[i];
        array[i] = array[j];
        array[j] = temp;
    }
    return array;
}

function showRandomCard(){
  var cardTypes =[puzzle, free, mc];
  var index = Math.floor(Math.random()*3);
  cardTypes[index]();
};

showRandomCard();
</script>









